<html mxlns:th="http://www.thymeleaf.org">

<head th:fragment="dateFragmentHead	">
	<meta charset="UTF-8">
	<title>Insert title here</title>
	<link rel="stylesheet" href="/style/book.css">
</head>

<body>
	<div id="bookArea" th:fragment="dateFragment">
		<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
		<link rel="stylesheet" th:href="@{/style/book.css}" />
		<div id="book_container">
			<form action="" class="date_selector">
				<div id="datepicker-container">
					<div id="datepicker"></div>
					<div class="hour_selector" id="hour_button">
						<button type="button" id="top_btn" class="btn btn-secondary">yy/mm/dd</button>
						<button type="button" name="first_time" class="btn btn-light">10:00</button>
						<button type="button" name="second_time" class="btn btn-light">12:00</button>
						<button type="button" name="third_time" class="btn btn-light">14:00</button>
						<button type="button" name="fourth_time" class="btn btn-light">16:00</button>
						<button type="button" name="fifth_time" class="btn btn-light">18:00</button>
						<button type="button" name="six_time" class="btn btn-light">20:00</button>
						<button type="button" name="last_time" class="btn btn-light">22:00</button>
					</div>
				</div>
			</form>
			<form id="submit_data">
				<div class="data_area" style="display:none" id="data_area_div">
					<input type="hidden" id="date_data_id" name="booked_theme_id" th:value="${theme.id}">
					<input type="hidden" id="date_data_hour" name="booked_hour">
					<input type="hidden" id="date_data_date" name="booked_date">
					<input type="hidden" id="date_data_name" name="booked_name">
					<input type="hidden" id="date_data_phone" name="booked_phone">
					<input type="hidden" id="date_data_email" name="booked_email">
					<input type="hidden" id="date_data_count" name="booked_count">
					<input type="hidden" id="date_data_timeline" name="booked_timeline" value="1">
				</div>
			</form>
		</div>
		<div id="user_container" style="display: none;">
			<div id="user_area" class="user_area">
				<div class="mb-3" style="padding: 1rem;">
					<label for="basic-url" class="form-label">이름(Name)</label>
					<div class="input-group">
						<input type="text" id="input_booked_name" class="form-control"
							aria-describedby="basic-addon3 basic-addon4">
					</div>
					<div class="form-text" id="basic-addon4">이름을 입력하세요</div>
				</div>
				<div class="mb-3" style="padding: 1rem;">
					<label for="basic-url" class="form-label">전화번호(Phone)</label>
					<div class="input-group">
						<input type="number" id="input_booked_phone" class="form-control" placeholder="010-0000-0000" oninput="checkInputValue(this)"
							aria-describedby="basic-addon3 basic-addon4">
					</div>
					<div class="form-text" id="basic-addon4">전화번호를 적어주세요</div>
				</div>
				<div class="mb-3" style="padding: 1rem;">
					<label for="basic-url" class="form-label">이메일(e-mail)</label>
					<div class="input-group">
						<input type="text" id="input_booked_email" class="form-control"
							aria-describedby="basic-addon3 basic-addon4">
					</div>
					<div class="form-text" id="basic-addon4">email을 입력하세요</div>
				</div>
			</div>
			<div style="height: 150px; padding: 4px; padding-bottom: 25px;">
				<div style="overflow-y:scroll; height:150px; padding:4px; border:1 solid #000000;">
					<b>* 예약의 경우 모두의 체험을 위해 중복예약은 어려우며 확인 시 예약주신 번호와 메일을 통해 확인 연락 및 취소안내를 드리고 있습니다. 중복예약 후 연락이 닿지 않거나
						반복적인 전일 취소와 미방문 및 허위 정보기입이 확인 될 경우 예약한 모든 내용이 취소 될 수 있으니 주의 부탁드립니다. 허위 정보로 인해 연락이 닿지 않는 경우 최종
						취소될 수 있으니 반드시 방문 전일 연락 가능한 번호를 통한 예약 바라며 미응답시 취소처리 될 수 있기에 주의하여 방문전일 및 방문일에 연락 가능한 번호를 통한 예약
						바랍니다. 비정상적인 방법을 통한 예약이 확인되거나 허위정보 방지를 위해 방문확인요청에 미응답시 예약이 최종 취소될 수 있으니 주의하여 예약 바랍니다. 확정된 최종시간 이외
						다른 건은 다른분들을 위해 취소 부탁드립니다. 중복예약으로인한 불이익이 발생할 수 있으니 주의 부탁드리며 또한 모두의 체험을 위해 배려해주시면
						감사드리겠습니다.</b><br><br><b>개인정보 수집, 이용 및 제공 등에 관한 고지사항</b><br>
					이용자 본인은 아래의 개인정보가 사실임을 확인하며, 아래와 같이 개인정보를 수집 및 이용하는 것에 동의합니다.<br>
					<br>
					<b>[개인정보의 수집 및 이용목적]</b><br>
					- 비회원 예매서비스 제공<br>
					- 예약 정보를 확인 및 관리하고, 필요 시 예약 이행 여부 확인을 위해 예약자에게 연락을 취할 목적 등<br>
					<br>
					<b>[수집하는 개인정보의 항목]</b><br>
					- 필수입력사항 : 이용자의 식별을 위한 정보<br>
					- 입력정보 : 이름, 휴대폰번호, 이메일 주소<br>
					<br>
					<b>[개인정보의 보유 및 이용기간]</b><br>
					개인정보의 수집목적 또는 제공 받은 목적이 달성되면 즉시 파기합니다. 다만, <br>
					상법 등 관련 법령의 규정에 의하여 거래관련 관리 의무 관계의 확인 등을 이유로 <br>
					대금결제및재화들 의공급에관한기록에 의거 5년간 보유합니다.<br>
					<br>
					* 개인 정보 제공에 동의하지 않을 권리가 있으며 개인 정보 제공에 <br>
					동의하지 않을 경우 비회원 서비스는 제공되지 않습니다.<br>
					<br>
					<b>[기술적/관리적 보호대책]</b><br>
					- Decoder는 서버 및 네트워크 관련 보안시스템을 갖추고 있습니다. 방화벽 등 해킹 등 외부침입에 대비하여 각 서버마다 <br>
					침입차단시스템 및 취약점 분석시스템 등을 갖추어 ‘이용자’가 제공한 개인정보보호에 만전을 기하고 있습니다. <br>
					개인 정보 취급직원 최소화는 물론 각 직원별 개인정보 접근권한을 달리하고, 수시보안교육을 통해 본 방침의 준수를 강조하고 있습니다. <br>
					- Dedocer는 “이용자” 개인의 실수나 기본적인 인터넷의 위험성 때문에 일어나는 일들에 대해 책임을 지지 않습니다.<br>
					- 그 외 내부 관리자의 실수나 기술관리 상의 사고로 인해 개인정보의 상실, 유출, 변조, 훼손이 유발될 경우 <br>
					Decoder는 즉각“이용자”에게 사실을 알리고 적절한 대책을 강구할 것입니다.
				</div>
			</div>
			<div class="radio_area">
				<div class="form-check">
					<input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios1" value="2"
						checked onclick="peopleCount(this)">
					<label class="form-check-label" for="exampleRadios1">
						2명
					</label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios2" value="3"
						onclick="peopleCount(this)">
					<label class="form-check-label" for="exampleRadios2">
						3명
					</label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios2" value="4"
						onclick="peopleCount(this)">
					<label class="form-check-label" for="exampleRadios2">
						4명
					</label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios2" value="5"
						onclick="peopleCount(this)">
					<label class="form-check-label" for="exampleRadios2">
						5명
					</label>
				</div>
			</div>
			<div class="book_btn_area">
				<button id="back_btn" type="button" class="btn btn-secondary">back</button>
				<button id="submit_btn" type="button" class="btn btn-secondary">next</button>
			</div>
		</div>
		<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
		<script src="https://code.jquery.com/jquery-3.6.4.js"></script>
		<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
		<script>

			function loadFragment() {
				var bookArea = document.getElementById('book_container');
				var userArea = document.getElementById('user_container')
				bookArea.style.display = 'none'
				userArea.style.display = 'flex'
				userArea.style.flexDirection = 'column';
			}

			$(function () {
				$("#datepicker").datepicker({
					dateFormat: 'yy/mm/dd',
					minDate: 0,
					showButtonPanel: false,
					changeMonth: false,
					changeYear: false,
					onSelect: function (dateText, inst) {
						$("#top_btn").html(dateText);
						$("#date_data_date").val(dateText);
					}
				});
				$("#datepicker").show();
			});

			$("#hour_button button").on("click", function () {
				if ($("#top_btn").html() != "yy/mm/dd") {
					$("#date_data_hour").val(this.name);
					loadFragment();
				}
				else {
					alert('날짜를 선택해주세요');
				}
			})
			document.getElementById('back_btn').onclick = () => {
				window.location.reload();
			}
			document.getElementById('submit_btn').onclick = () => {
				var userName = document.getElementById('input_booked_name');
				var userPhone = document.getElementById('input_booked_phone');
				var userEmail = document.getElementById('input_booked_email');
				if (userName.value != "" &&
					userPhone.value != "" &&
					userEmail.value != ""
				) {
					document.getElementById('date_data_name').value = userName.value;
					document.getElementById('date_data_phone').value = userPhone.value;
					document.getElementById('date_data_email').value = userEmail.value;
					var dataDiv = document.getElementById('data_area_div');
					var datainput = dataDiv.getElementsByTagName('input');
					var formdata = new FormData(document.getElementById('submit_data'));
					axios.post('/book/userdata', formdata)
						.then(function (response) {
							console.log(response.data);
							alert('예약이 완료되었습니다.');
							window.location.href = "/";
						}).catch(function (error) {
							console.log('error', error);
						})
				} else {
					alert('필수 입력 정보를 모두 기입해주세요')
				}
			}
			function peopleCount(radio) {
				var input = document.getElementById('date_data_count');
				input.value = radio.value;
			}
			function checkInputValue(input) {
				if (isNaN(input.value)) {
					input.value = '';
				}
			}
		</script>
	</div>
</body>

</html>